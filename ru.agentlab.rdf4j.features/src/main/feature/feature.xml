<?xml version="1.0" encoding="UTF-8"?>
<!-- 
/********************************************************************************
 * Copyright (c) 2020 Agentlab and others.
 *
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License v. 2.0 which is available at
 * https://www.eclipse.org/legal/epl-2.0.
 *
 * SPDX-License-Identifier: EPL-2.0
 ********************************************************************************/
 -->
<features name="ru.agentlab.rdf4j-${project.version}" xmlns="http://karaf.apache.org/xmlns/features/v1.4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.4.0">

    <feature name="pax-logging-log4j2-extra" version="${pax.logging.version}">
    	<feature>jackson-core</feature>
        <bundle start-level="8">mvn:org.ops4j.pax.logging/pax-logging-log4j2-extra/${pax.logging.version}</bundle>
    </feature>

   <feature version="${jackson.version}" name="jackson-core">
    	<bundle dependency="true">mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}</bundle>
    	<bundle dependency="true">mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}</bundle>
    	<bundle dependency="true">mvn:com.fasterxml.jackson.core/jackson-databind/${jackson.version}</bundle>
    	
    	<bundle dependency="true">mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/${jackson.version}</bundle>
        <bundle dependency="true">mvn:com.fasterxml.jackson.datatype/jackson-datatype-jdk8/${jackson.version}</bundle>
    </feature>

    <feature name="rdf4j-client" version="${rdf4j.version}">
        <!-- надо перевести на pax-logging -->
        <bundle dependency="true">mvn:org.slf4j/slf4j-api/${slf4j.version}</bundle>
        <!--<bundle dependency="true">mvn:org.slf4j/slf4j-jdk14/${slf4j.version}</bundle>-->
        <bundle dependency="true">mvn:org.slf4j/jcl-over-slf4j/${slf4j.version}</bundle>
        <bundle dependency="true">mvn:org.slf4j/log4j-over-slf4j/${slf4j.version}</bundle>
        <bundle dependency="true">mvn:org.slf4j/slf4j-simple/${slf4j.version}</bundle>
        <bundle dependency="true">mvn:ch.qos.logback/logback-classic/1.1.11</bundle>
		<bundle dependency="true">mvn:ch.qos.logback/logback-core/1.1.11</bundle>
		<!-- надо бы удалить и перевести на pax-logging, но новый pax-logging не экспортит log4j.core -->
		<bundle dependency="true">mvn:org.apache.logging.log4j/log4j-core/2.8.2</bundle>
		
		<feature>jackson-core</feature>

        <bundle dependency="true">mvn:commons-cli/commons-cli/${commons.cli.version}</bundle>
        <bundle dependency="true">mvn:commons-fileupload/commons-fileupload/${commons.fileupload.version}</bundle>
        <bundle dependency="true">mvn:commons-io/commons-io/${commons.io.version}</bundle>
        <bundle dependency="true">mvn:commons-codec/commons-codec/${commons.codec.version}</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-lang3/${commons.lang3.version}</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-text/${commons.text.version}</bundle>

        <bundle dependency="true">mvn:org.apache.httpcomponents/httpclient-osgi/${httpclient.version}</bundle>
        <bundle dependency="true">mvn:org.apache.httpcomponents/httpcore-osgi/${httpcore.version}</bundle>

        <bundle dependency="true">mvn:org.locationtech.spatial4j/spatial4j/${spatial4j.version}</bundle>
        <bundle dependency="true">mvn:org.locationtech.jts/jts-core/${jts.core.version}</bundle>

        <bundle dependency="true">mvn:com.google.guava/guava/${guava.version}</bundle>
        <bundle dependency="true">mvn:com.google.guava/failureaccess/1.0.1</bundle>

        <bundle dependency="true">mvn:com.github.jsonld-java/jsonld-java/${jsonldjava.version}</bundle>
        <bundle dependency="true">mvn:org.mapdb/mapdb/${mapdb.version}</bundle>
        <bundle dependency="true">mvn:javax.xml.bind/jaxb-api/2.3.0</bundle>

        <bundle dependency="true">mvn:com.opencsv/opencsv/${opencsv.version}</bundle>

        <bundle dependency="true">mvn:commons-beanutils/commons-beanutils/${commons-beanutils.version}</bundle>
        <bundle dependency="true">mvn:commons-collections/commons-collections/${commons-collections.version}</bundle>
        <bundle dependency="true">mvn:org.apache.commons/commons-collections4/${commons-collections4.version}</bundle>

        <!-- rdf4j-client -->
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-http-client/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-http-protocol/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-model-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-model-vocabulary/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-model/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-query/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryalgebra-model/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryparser-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryparser-sparql/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryrender/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryresultio-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryresultio-binary/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryresultio-sparqljson/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryresultio-sparqlxml/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryresultio-text/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-contextaware/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-event/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-http/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-manager/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-sparql/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-binary/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-datatypes/${rdf4j.version}</bundle>
        <!--<bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-hdt/${rdf4j.version}</bundle>-->
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-jsonld/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-languages/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-n3/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-nquads/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-ntriples/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-rdfjson/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-rdfxml/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-trig/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-trix/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-rio-turtle/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sparqlbuilder/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-annotation/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-exception/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-io/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-iterator/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-text/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-transaction/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-util/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-common-xml/${rdf4j.version}</bundle>
    </feature>

    <feature name="rdf4j-storage" version="${rdf4j.version}">
    	<feature version="${rdf4j.version}" dependency="true">rdf4j-client</feature>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryalgebra-evaluation/${rdf4j.version}</bundle>
        <!--<bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-queryalgebra-geosparql/${rdf4j.version}</bundle>-->
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-dataset/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-repository-sail/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-base/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-federation/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-inferencer/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-model/${rdf4j.version}</bundle>
        <!--<bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-elasticsearch/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-lucene-api/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-lucene/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-solr/${rdf4j.version}</bundle>-->
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-memory/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-nativerdf/${rdf4j.version}</bundle>
        <!--<bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-spin/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-spin/${rdf4j.version}</bundle>-->
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-shacl/${rdf4j.version}</bundle>
        <!-- not included but exists here -->
        <!--<bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-elasticsearch-store/${rdf4j.version}</bundle>
        <bundle start-level="80">mvn:org.eclipse.rdf4j/rdf4j-sail-extensible-store/${rdf4j.version}</bundle>-->
    </feature>

    <feature name="rdf4j-http-server" version="${rdf4j.version}">
        <feature version="${rdf4j.version}" prerequisite="true">rdf4j-storage</feature>
        <feature prerequisite="true">karaf-scr</feature>
        <feature version="${pax.web.version}" prerequisite="true">pax-web-http-whiteboard</feature>
        <feature version="${spring.version}" prerequisite="true">spring-web</feature>
        <bundle start-level="100">mvn:org.eclipse.rdf4j/rdf4j-http-server-spring/${rdf4j.version}</bundle>
        <bundle start-level="100">mvn:org.eclipse.rdf4j/rdf4j-config/${rdf4j.version}</bundle>
        <bundle start-level="100">mvn:org.eclipse.rdf4j/rdf4j-tools-federation/${rdf4j.version}</bundle>
    </feature>

	<repository>mvn:org.apache.karaf.features/standard/${karaf.version}/xml/features</repository>
    <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>

    <feature name="karaf-scr" version="${project.version}">
    	<feature>obr</feature>
    	<feature>scr</feature>
    	<bundle dependency="true">mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.javax-inject/1_3</bundle>
    </feature>

    <feature name="spring-blueprint" version="${spring.version}">
        <feature prerequisite="true">karaf-scr</feature>
        <feature version="${pax.web.version}" prerequisite="true">pax-web-http-whiteboard</feature>
    	<!-- Web-Console -->
        <feature prerequisite="true">webconsole</feature>
		<feature prerequisite="true">war</feature>

        <feature version="${spring.version}">spring-web</feature>
        <feature version="${spring.version}">spring-tx</feature>
        <feature version="${spring.version}">spring-aspects</feature>
        <feature version="${spring.version}">spring-instrument</feature>
        <!--<feature prerequisite="true">blueprint-web</feature>-->
        <feature prerequisite="true">aries-blueprint-spring</feature>
        <!--<bundle>mvn:ch.sourcepond.spring/spring-web-blueprint/0.4-SNAPSHOT</bundle>-->
    </feature>

	<feature name="rdf4j-spring" version="${project.version}">
	    <feature version="${spring.version}" prerequisite="true">spring-blueprint</feature>
        <feature version="${rdf4j.version}" prerequisite="true">rdf4j-http-server</feature>

        <bundle>mvn:ru.agentlab.rdf4j/ru.agentlab.rdf4j.server/${project.version}</bundle>
        <!--<bundle>mvn:ru.agentlab.rdf4j/ru.agentlab.rdf4j.sail.shacl/${project.version}</bundle>-->
    </feature>
    
    <feature name="rdf4j-spring2" version="${project.version}">
    	<!-- <feature prerequisite="true" dependency="false">wrap</feature> -->
	    <feature version="${spring.version}" prerequisite="true">spring-blueprint</feature>
        <feature version="${rdf4j.version}" prerequisite="true">rdf4j-http-server</feature>

        <!-- <bundle>wrap:mvn:com.github.ziplet/ziplet/2.4.1</bundle> -->
        <!-- org.ebaysf.web/cors-filter, org.tuckey/urlrewritefilter -->
        <bundle>mvn:ru.agentlab.rdf4j/ru.agentlab.rdf4j.server2/${project.version}</bundle>
    </feature>
</features>

